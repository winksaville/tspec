diff --git a/.claude/a61b758b-0ffc-474b-950f-45c9c8ba5a1c.jsonl b/.claude/a61b758b-0ffc-474b-950f-45c9c8ba5a1c.jsonl
index f166275..cc7a621 100644
--- a/.claude/a61b758b-0ffc-474b-950f-45c9c8ba5a1c.jsonl
+++ b/.claude/a61b758b-0ffc-474b-950f-45c9c8ba5a1c.jsonl
@@ -114,3 +114,31 @@
 {"parentUuid":"e6c99f70-61dc-4531-b04a-364049fc1dc2","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01GexJP4tSTbF3XUDx1tH7G9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LL9P4S1zmqHVoaMmJCib7v","name":"Bash","input":{"command":"git -C /home/wink/data/prgs/rust/tspec status","description":"Verify commit succeeded"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":293,"cache_read_input_tokens":60392,"output_tokens":90,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":293,"ephemeral_5m_input_tokens":0}}},"requestId":"req_011CXudxDfHWWJh3L3eZjwvZ","type":"assistant","uuid":"73c47e9c-fd11-4d06-9acc-9d8663c676b4","timestamp":"2026-02-08T00:15:15.347Z"}
 {"parentUuid":"73c47e9c-fd11-4d06-9acc-9d8663c676b4","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LL9P4S1zmqHVoaMmJCib7v","type":"tool_result","content":"On branch main\nYour branch is ahead of 'origin/main' by 1 commit.\n  (use \"git push\" to publish your local commits)\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\t.claude/a61b758b-0ffc-474b-950f-45c9c8ba5a1c.jsonl\n\t.claude/a6685fb6-0542-4693-9ff7-7a2742866414.jsonl\n\t.claude/a6685fb6-0542-4693-9ff7-7a2742866414/\n\tt1-001-7fd7a840-001-76a08d3b.ts.toml\n\tt1-001-7fd7a840.ts.toml\n\tt1.ts.toml\n\ttspec-strip\n\nnothing added to commit but untracked files present (use \"git add\" to track)","is_error":false}]},"uuid":"37338915-68ec-472e-ab5b-c7e46038b9ae","timestamp":"2026-02-08T00:15:21.294Z","toolUseResult":{"stdout":"On branch main\nYour branch is ahead of 'origin/main' by 1 commit.\n  (use \"git push\" to publish your local commits)\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\t.claude/a61b758b-0ffc-474b-950f-45c9c8ba5a1c.jsonl\n\t.claude/a6685fb6-0542-4693-9ff7-7a2742866414.jsonl\n\t.claude/a6685fb6-0542-4693-9ff7-7a2742866414/\n\tt1-001-7fd7a840-001-76a08d3b.ts.toml\n\tt1-001-7fd7a840.ts.toml\n\tt1.ts.toml\n\ttspec-strip\n\nnothing added to commit but untracked files present (use \"git add\" to track)","stderr":"","interrupted":false,"isImage":false},"sourceToolAssistantUUID":"73c47e9c-fd11-4d06-9acc-9d8663c676b4"}
 {"parentUuid":"37338915-68ec-472e-ab5b-c7e46038b9ae","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_014nrTPVnMULQ7EeWVm6ya64","type":"message","role":"assistant","content":[{"type":"text","text":"Committed 160222e.\n\nRemember to commit .claude/ session files."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":332,"cache_read_input_tokens":60685,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":332},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXudxruPpd5txoZ3mtjEj","type":"assistant","uuid":"473452d1-a3eb-40e2-9251-f6455ab885b3","timestamp":"2026-02-08T00:15:24.987Z"}
+{"type":"file-history-snapshot","messageId":"ec052246-8a0b-41e6-bb57-64dcbb95f962","snapshot":{"messageId":"ec052246-8a0b-41e6-bb57-64dcbb95f962","trackedFileBackups":{"src/ts_cmd/set.rs":{"backupFileName":"a2565033032b5dbe@v2","version":2,"backupTime":"2026-02-08T00:14:14.088Z"},"src/cmd/ts.rs":{"backupFileName":"e2251d2c5ab28f04@v2","version":2,"backupTime":"2026-02-08T00:14:14.090Z"},"src/ts_cmd/backup.rs":{"backupFileName":"8e726b68ba4786f1@v2","version":2,"backupTime":"2026-02-08T00:14:14.091Z"},"src/ts_cmd/restore.rs":{"backupFileName":"7c09d9c89b5f6a5d@v2","version":2,"backupTime":"2026-02-08T00:14:14.093Z"},"src/ts_cmd/mod.rs":{"backupFileName":"64a023b44b4e6d0c@v2","version":2,"backupTime":"2026-02-08T00:14:14.094Z"}},"timestamp":"2026-02-08T00:26:40.025Z"},"isSnapshotUpdate":false}
+{"parentUuid":"473452d1-a3eb-40e2-9251-f6455ab885b3","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":"I've pushed and bumped the version, let's update the docs and then add `In-place ..` to ## Done in todo and we'll do some more experiments to see what else we want to change."},"uuid":"ec052246-8a0b-41e6-bb57-64dcbb95f962","timestamp":"2026-02-08T00:26:40.024Z","thinkingMetadata":{"maxThinkingTokens":31999},"permissionMode":"acceptEdits"}
+{"parentUuid":"ec052246-8a0b-41e6-bb57-64dcbb95f962","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01JyAqHnCsiLdwjBTEdL1eXw","type":"message","role":"assistant","content":[{"type":"text","text":"\n\n"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":47,"cache_read_input_tokens":61035,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":47},"output_tokens":14,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXuepu32gZwLUsspLo7yB","type":"assistant","uuid":"04599e27-30d4-4c34-a4e5-822d5119f35b","timestamp":"2026-02-08T00:26:42.193Z"}
+{"parentUuid":"04599e27-30d4-4c34-a4e5-822d5119f35b","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01JyAqHnCsiLdwjBTEdL1eXw","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to:\n1. Update the docs (chores-2.md) to mark the \"In-place set, add backup and restore\" item as Done\n2. Move the \"In-place...\" item from Todo to Done in todo.md\n\nLet me read the current state of both files first.","signature":"EosDCkYICxgCKkB2uydQRAio99NcUov8pisB3TRXKePwu0nzXFYJIoLg6oXdN6IjEvs/fJHqGIBbiEVYIuF/VfhSIU/9H7bfrUQzEgyxXVIy/meD7c567TIaDMThg6lXRrupg5rl3yIwOUFZ1hhmIN8z1GRYiIojqdUQaDykND8HeIprr2mKn2dpGfrjffZSTBte5xvmCQpnKvIBTAVhmIE3aTlBWErB00eJf9GbIOF2/Hbbr9H3ytQdUakJvkkkXSIWugsKllNiydSWKh6K9IpKe1Y34J6XNVreUqGTFjzOgi4xO/wU8knDVf+YlSLcpKjxY2XhptTtSfgMq5pHwgl9q7qkCwoS1GXIxFnR+PlEOQU/sh8Kvd05or3ulpzU98Vq7+4m50eu8GKvIMQ7pXtbXIBNbfvpsv0lK42CZznKUmwcbrQltHW1tlYLomy5y/qXHG7uI77zN8u6p4nuRH0t0ngdW58a0f0TNd3sAj4jAfH+v+i/Q1daPyFHEz1PH8VLHhr60crt1tVoGQUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":47,"cache_read_input_tokens":61035,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":47},"output_tokens":14,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXuepu32gZwLUsspLo7yB","type":"assistant","uuid":"c14aa8e1-8f8c-4e27-8bce-09239f66ac86","timestamp":"2026-02-08T00:26:43.685Z"}
+{"parentUuid":"c14aa8e1-8f8c-4e27-8bce-09239f66ac86","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01JyAqHnCsiLdwjBTEdL1eXw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KXWzGiPWTzpTPC5KdDfXve","name":"Read","input":{"file_path":"/home/wink/data/prgs/rust/tspec/notes/todo.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":47,"cache_read_input_tokens":61035,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":47},"output_tokens":14,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXuepu32gZwLUsspLo7yB","type":"assistant","uuid":"da780875-ad8e-4cde-ab41-b9e1c5d54599","timestamp":"2026-02-08T00:26:44.161Z"}
+{"parentUuid":"da780875-ad8e-4cde-ab41-b9e1c5d54599","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_01KXWzGiPWTzpTPC5KdDfXve","toolUseID":"toolu_01KXWzGiPWTzpTPC5KdDfXve","timestamp":"2026-02-08T00:26:44.165Z","uuid":"a7b5ab16-60b8-4218-b88c-e8604fd0962f"}
+{"parentUuid":"da780875-ad8e-4cde-ab41-b9e1c5d54599","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KXWzGiPWTzpTPC5KdDfXve","type":"tool_result","content":"     1→# Todo\n     2→\n     3→## In Progress\n     4→\n     5→## Todo\n     6→\n     7→- In-place `set`, add `backup` and `restore` subcommands [15]\n     8→- Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]\n     9→- Improve `classify_crate` - using name alone is brittle [4]\n    10→\n    11→## Done\n    12→\n    13→See older [done.md](done.md)\n    14→\n    15→- Add `cargo.target_dir` spec field for per-spec target directories [12],[14]\n    16→\n    17→[4]: chores-1.md#improve-classify_crate\n    18→[11]: chores-1.md#investigate--static-vs-dynamic-linkingfalse-size-difference\n    19→[12]: chores-1.md#per-spec-target-directories\n    20→[14]: chores-2.md#20260206---add-cargotarget_dir-spec-field\n    21→[15]: chores-2.md#20260207---in-place-set-add-backup-and-restore-subcommands\n    22→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f6bb3f4e-ec86-4956-a6c2-3b3d213898f3","timestamp":"2026-02-08T00:26:44.164Z","toolUseResult":{"type":"text","file":{"filePath":"/home/wink/data/prgs/rust/tspec/notes/todo.md","content":"# Todo\n\n## In Progress\n\n## Todo\n\n- In-place `set`, add `backup` and `restore` subcommands [15]\n- Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]\n- Improve `classify_crate` - using name alone is brittle [4]\n\n## Done\n\nSee older [done.md](done.md)\n\n- Add `cargo.target_dir` spec field for per-spec target directories [12],[14]\n\n[4]: chores-1.md#improve-classify_crate\n[11]: chores-1.md#investigate--static-vs-dynamic-linkingfalse-size-difference\n[12]: chores-1.md#per-spec-target-directories\n[14]: chores-2.md#20260206---add-cargotarget_dir-spec-field\n[15]: chores-2.md#20260207---in-place-set-add-backup-and-restore-subcommands\n","numLines":22,"startLine":1,"totalLines":22}},"sourceToolAssistantUUID":"da780875-ad8e-4cde-ab41-b9e1c5d54599"}
+{"parentUuid":"f6bb3f4e-ec86-4956-a6c2-3b3d213898f3","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01JyAqHnCsiLdwjBTEdL1eXw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017yoAB1skyNQRj6NWGTkjR6","name":"Read","input":{"file_path":"/home/wink/data/prgs/rust/tspec/notes/chores-2.md","offset":150}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":47,"cache_read_input_tokens":61035,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":47},"output_tokens":14,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXuepu32gZwLUsspLo7yB","type":"assistant","uuid":"10f37be4-6232-4dcf-8850-35ec20d2e14c","timestamp":"2026-02-08T00:26:44.790Z"}
+{"parentUuid":"10f37be4-6232-4dcf-8850-35ec20d2e14c","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Read","command":"callback"},"parentToolUseID":"toolu_017yoAB1skyNQRj6NWGTkjR6","toolUseID":"toolu_017yoAB1skyNQRj6NWGTkjR6","timestamp":"2026-02-08T00:26:44.792Z","uuid":"337522af-c304-44f1-8726-982b6f5acc3f"}
+{"parentUuid":"10f37be4-6232-4dcf-8850-35ec20d2e14c","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017yoAB1skyNQRj6NWGTkjR6","type":"tool_result","content":"   150→9. **Tests**\n   151→   - Unit tests for `expand_target_dir` (None, empty, literal, `<name>`, `<hash>`, combined)\n   152→   - Unit tests for `spec_name_from_path`\n   153→   - Unit test for `get_binary_path` with target_dir\n   154→   - Unit test for `apply_value` with `cargo.target_dir`\n   155→   - Existing tests: append `None` to `get_binary_path` calls (mechanical)\n   156→\n   157→**Status:** Done\n   158→\n   159→## 20260207 - In-place `set`, add `backup` and `restore` subcommands\n   160→\n   161→### The Problem\n   162→\n   163→`tspec ts set` creates a new snapshot file (`name-NNN-hash.ts.toml`) on every edit.\n   164→Chaining edits compounds the names: `t1-001-xxx-001-yyy.ts.toml`. The file you work\n   165→with should keep its name; backup/restore should be explicit user actions.\n   166→\n   167→### The Design\n   168→\n   169→1. **`tspec ts set`** modifies the file in place (no snapshot creation)\n   170→2. **`tspec ts backup -t t1.ts.toml`** creates `t1-001-<hash>.ts.toml`\n   171→3. **`tspec ts restore -t t1-001-<hash>.ts.toml`** copies it back to `t1.ts.toml`\n   172→4. Backups are valid specs — `tspec build -t t1-001-<hash>.ts.toml` works directly\n   173→\n   174→### The Plan\n   175→\n   176→#### 1. Modify `tspec ts set` to save in place\n   177→\n   178→**File:** `src/ts_cmd/set.rs`\n   179→\n   180→- Change `set_value()` to save back to the original file path instead of calling `save_spec_snapshot()`\n   181→- If the file existed (found via `find_tspec()`), save to that path\n   182→- If no file existed, construct path from `-t` arg (or default `tspec`) + `TSPEC_SUFFIX` in package dir\n   183→- Use existing `save_spec()` instead of `save_spec_snapshot()`\n   184→- Remove `save_spec_snapshot` import\n   185→\n   186→**File:** `src/cmd/ts.rs`\n   187→- Update `Set` variant doc comment from \"creates versioned copy\" to \"modifies in place\"\n   188→\n   189→#### 2. Add `tspec ts backup` subcommand\n   190→\n   191→**New file:** `src/ts_cmd/backup.rs`\n   192→\n   193→```rust\n   194→pub fn backup_tspec(project_root, package, tspec) -> Result<()>\n   195→```\n   196→\n   197→- Locate the spec via `find_tspec()`; error if not found\n   198→- Extract base name via `spec_name_from_path()`\n   199→- Load the spec, call existing `save_spec_snapshot()` to create `{name}-NNN-{hash}.ts.toml`\n   200→- Print the backup filename\n   201→\n   202→**File:** `src/cmd/ts.rs` — add `Backup` variant with `-p` and `-t` args, dispatch\n   203→**File:** `src/ts_cmd/mod.rs` — add `mod backup;` and `pub use backup::backup_tspec;`\n   204→\n   205→#### 3. Add `tspec ts restore` subcommand\n   206→\n   207→**New file:** `src/ts_cmd/restore.rs`\n   208→\n   209→```rust\n   210→pub fn restore_tspec(project_root, package, tspec) -> Result<()>\n   211→```\n   212→\n   213→- Locate the backup file via `find_tspec()` (`-t` required)\n   214→- Parse the filename to extract the base name by stripping trailing `-NNN-HHHHHHHH`\n   215→  (3-digit seq + 8-char hex hash) from the stem before `.ts.toml`\n   216→- Construct target path: `{base_name}.ts.toml` in the same directory\n   217→- Copy content to the base file using `load_spec()` + `save_spec()`\n   218→- Print what was restored\n   219→\n   220→**File:** `src/cmd/ts.rs` — add `Restore` variant with `-p` and `-t` (required) args, dispatch\n   221→**File:** `src/ts_cmd/mod.rs` — add `mod restore;` and `pub use restore::restore_tspec;`\n   222→\n   223→### Files modified\n   224→- `src/ts_cmd/set.rs` — save in place instead of snapshot\n   225→- `src/cmd/ts.rs` — add Backup/Restore variants, update Set doc\n   226→- `src/ts_cmd/mod.rs` — register new modules\n   227→\n   228→### Files created\n   229→- `src/ts_cmd/backup.rs` — backup logic\n   230→- `src/ts_cmd/restore.rs` — restore logic (with name-suffix parsing)\n   231→\n   232→### Verification\n   233→```bash\n   234→tspec test -p tspec\n   235→tspec clippy\n   236→tspec fmt --check\n   237→\n   238→# Manual smoke test:\n   239→tspec ts new t2\n   240→tspec ts set strip=symbols -t t2.ts.toml      # modifies t2.ts.toml in place\n   241→tspec ts show -t t2.ts.toml                    # shows strip = \"symbols\"\n   242→tspec ts backup -t t2.ts.toml                  # creates t2-001-<hash>.ts.toml\n   243→tspec ts set panic=abort -t t2.ts.toml         # modifies t2.ts.toml again\n   244→tspec ts show -t t2.ts.toml                    # shows panic + strip\n   245→tspec ts restore -t t2-001-<hash>.ts.toml      # restores t2.ts.toml to pre-panic state\n   246→tspec build -t t2-001-<hash>.ts.toml           # backup usable directly\n   247→```\n   248→\n   249→**Status:** Todo\n   250→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"452c7659-6787-4001-a321-376d2eb519a7","timestamp":"2026-02-08T00:26:44.792Z","toolUseResult":{"type":"text","file":{"filePath":"/home/wink/data/prgs/rust/tspec/notes/chores-2.md","content":"9. **Tests**\n   - Unit tests for `expand_target_dir` (None, empty, literal, `<name>`, `<hash>`, combined)\n   - Unit tests for `spec_name_from_path`\n   - Unit test for `get_binary_path` with target_dir\n   - Unit test for `apply_value` with `cargo.target_dir`\n   - Existing tests: append `None` to `get_binary_path` calls (mechanical)\n\n**Status:** Done\n\n## 20260207 - In-place `set`, add `backup` and `restore` subcommands\n\n### The Problem\n\n`tspec ts set` creates a new snapshot file (`name-NNN-hash.ts.toml`) on every edit.\nChaining edits compounds the names: `t1-001-xxx-001-yyy.ts.toml`. The file you work\nwith should keep its name; backup/restore should be explicit user actions.\n\n### The Design\n\n1. **`tspec ts set`** modifies the file in place (no snapshot creation)\n2. **`tspec ts backup -t t1.ts.toml`** creates `t1-001-<hash>.ts.toml`\n3. **`tspec ts restore -t t1-001-<hash>.ts.toml`** copies it back to `t1.ts.toml`\n4. Backups are valid specs — `tspec build -t t1-001-<hash>.ts.toml` works directly\n\n### The Plan\n\n#### 1. Modify `tspec ts set` to save in place\n\n**File:** `src/ts_cmd/set.rs`\n\n- Change `set_value()` to save back to the original file path instead of calling `save_spec_snapshot()`\n- If the file existed (found via `find_tspec()`), save to that path\n- If no file existed, construct path from `-t` arg (or default `tspec`) + `TSPEC_SUFFIX` in package dir\n- Use existing `save_spec()` instead of `save_spec_snapshot()`\n- Remove `save_spec_snapshot` import\n\n**File:** `src/cmd/ts.rs`\n- Update `Set` variant doc comment from \"creates versioned copy\" to \"modifies in place\"\n\n#### 2. Add `tspec ts backup` subcommand\n\n**New file:** `src/ts_cmd/backup.rs`\n\n```rust\npub fn backup_tspec(project_root, package, tspec) -> Result<()>\n```\n\n- Locate the spec via `find_tspec()`; error if not found\n- Extract base name via `spec_name_from_path()`\n- Load the spec, call existing `save_spec_snapshot()` to create `{name}-NNN-{hash}.ts.toml`\n- Print the backup filename\n\n**File:** `src/cmd/ts.rs` — add `Backup` variant with `-p` and `-t` args, dispatch\n**File:** `src/ts_cmd/mod.rs` — add `mod backup;` and `pub use backup::backup_tspec;`\n\n#### 3. Add `tspec ts restore` subcommand\n\n**New file:** `src/ts_cmd/restore.rs`\n\n```rust\npub fn restore_tspec(project_root, package, tspec) -> Result<()>\n```\n\n- Locate the backup file via `find_tspec()` (`-t` required)\n- Parse the filename to extract the base name by stripping trailing `-NNN-HHHHHHHH`\n  (3-digit seq + 8-char hex hash) from the stem before `.ts.toml`\n- Construct target path: `{base_name}.ts.toml` in the same directory\n- Copy content to the base file using `load_spec()` + `save_spec()`\n- Print what was restored\n\n**File:** `src/cmd/ts.rs` — add `Restore` variant with `-p` and `-t` (required) args, dispatch\n**File:** `src/ts_cmd/mod.rs` — add `mod restore;` and `pub use restore::restore_tspec;`\n\n### Files modified\n- `src/ts_cmd/set.rs` — save in place instead of snapshot\n- `src/cmd/ts.rs` — add Backup/Restore variants, update Set doc\n- `src/ts_cmd/mod.rs` — register new modules\n\n### Files created\n- `src/ts_cmd/backup.rs` — backup logic\n- `src/ts_cmd/restore.rs` — restore logic (with name-suffix parsing)\n\n### Verification\n```bash\ntspec test -p tspec\ntspec clippy\ntspec fmt --check\n\n# Manual smoke test:\ntspec ts new t2\ntspec ts set strip=symbols -t t2.ts.toml      # modifies t2.ts.toml in place\ntspec ts show -t t2.ts.toml                    # shows strip = \"symbols\"\ntspec ts backup -t t2.ts.toml                  # creates t2-001-<hash>.ts.toml\ntspec ts set panic=abort -t t2.ts.toml         # modifies t2.ts.toml again\ntspec ts show -t t2.ts.toml                    # shows panic + strip\ntspec ts restore -t t2-001-<hash>.ts.toml      # restores t2.ts.toml to pre-panic state\ntspec build -t t2-001-<hash>.ts.toml           # backup usable directly\n```\n\n**Status:** Todo\n","numLines":101,"startLine":150,"totalLines":250}},"sourceToolAssistantUUID":"10f37be4-6232-4dcf-8850-35ec20d2e14c"}
+{"type":"file-history-snapshot","messageId":"ce6f901d-6123-4a0a-a9cb-aa7afb1d65dc","snapshot":{"messageId":"ec052246-8a0b-41e6-bb57-64dcbb95f962","trackedFileBackups":{"src/ts_cmd/set.rs":{"backupFileName":"a2565033032b5dbe@v2","version":2,"backupTime":"2026-02-08T00:14:14.088Z"},"src/cmd/ts.rs":{"backupFileName":"e2251d2c5ab28f04@v2","version":2,"backupTime":"2026-02-08T00:14:14.090Z"},"src/ts_cmd/backup.rs":{"backupFileName":"8e726b68ba4786f1@v2","version":2,"backupTime":"2026-02-08T00:14:14.091Z"},"src/ts_cmd/restore.rs":{"backupFileName":"7c09d9c89b5f6a5d@v2","version":2,"backupTime":"2026-02-08T00:14:14.093Z"},"src/ts_cmd/mod.rs":{"backupFileName":"64a023b44b4e6d0c@v2","version":2,"backupTime":"2026-02-08T00:14:14.094Z"},"notes/chores-2.md":{"backupFileName":"86cffcb836353b51@v1","version":1,"backupTime":"2026-02-08T00:26:48.231Z"}},"timestamp":"2026-02-08T00:26:40.025Z"},"isSnapshotUpdate":true}
+{"parentUuid":"452c7659-6787-4001-a321-376d2eb519a7","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_0112jnBXakKB1ChstaXEMD8j","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Wdh1G5eKiDGfvAG72idTBf","name":"Edit","input":{"replace_all":false,"file_path":"/home/wink/data/prgs/rust/tspec/notes/chores-2.md","old_string":"**Status:** Todo","new_string":"**Status:** Done"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2554,"cache_read_input_tokens":61082,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":2554},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXueqFBje8aBFZrNZDXho","type":"assistant","uuid":"ce6f901d-6123-4a0a-a9cb-aa7afb1d65dc","timestamp":"2026-02-08T00:26:48.223Z"}
+{"parentUuid":"ce6f901d-6123-4a0a-a9cb-aa7afb1d65dc","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01Wdh1G5eKiDGfvAG72idTBf","toolUseID":"toolu_01Wdh1G5eKiDGfvAG72idTBf","timestamp":"2026-02-08T00:26:48.249Z","uuid":"43e1d86a-106a-46bc-a1bd-ec4a8c771984"}
+{"parentUuid":"ce6f901d-6123-4a0a-a9cb-aa7afb1d65dc","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Wdh1G5eKiDGfvAG72idTBf","type":"tool_result","content":"The file /home/wink/data/prgs/rust/tspec/notes/chores-2.md has been updated successfully."}]},"uuid":"e1e60c54-d1fd-4a3e-9dbf-dbc6916e94f8","timestamp":"2026-02-08T00:26:48.248Z","toolUseResult":{"filePath":"/home/wink/data/prgs/rust/tspec/notes/chores-2.md","oldString":"**Status:** Todo","newString":"**Status:** Done","originalFile":"# Chores-2\n\nContinued maintenance tasks, following on from chores-1.\n\n## 20260206 - Ts Execute Conversion\n\n### Convert `Commands::Ts` to use Execute trait\n\nThe `Ts` variant in `Commands` is the only command that doesn't use the `Execute` trait. All other commands (Build, Run, Test, Clean, Clippy, Fmt, Compare, Version, Install) follow the pattern where a command struct implements `Execute` and main.rs calls `cmd.execute(&project_root)`. The `Ts` subcommands instead destructure fields in main.rs and call free functions from `ts_cmd::*`.\n\n**Current state in main.rs:**\n```rust\nCommands::Ts { command } => match command {\n    TsCommands::List { package, all } => {\n        ts_cmd::list_tspecs(package.as_deref(), all)?;\n    }\n    TsCommands::Show { package, all, tspec } => {\n        ts_cmd::show_tspec(package.as_deref(), all, tspec.as_deref())?;\n    }\n    TsCommands::Hash { package, all, tspec } => {\n        ts_cmd::hash_tspec(package.as_deref(), all, tspec.as_deref())?;\n    }\n    TsCommands::New { name, package, from } => {\n        ts_cmd::new_tspec(package.as_deref(), &name, from.as_deref())?;\n    }\n    TsCommands::Set { assignment, package, tspec } => {\n        let (key, value) = assignment.split_once('=')...;\n        ts_cmd::set_value(package.as_deref(), key, value, tspec.as_deref())?;\n    }\n},\n```\n\n**Goal state in main.rs:**\n```rust\nCommands::Ts(cmd) => {\n    cmd.execute(&find_project_root()?)?;\n}\n```\n\n**Implementation steps:**\n\n1. **Create `src/cmd/ts.rs`** with a `TsCmd` struct that wraps `TsCommands`:\n   ```rust\n   #[derive(Args)]\n   pub struct TsCmd {\n       #[command(subcommand)]\n       command: TsCommands,\n   }\n\n   impl Execute for TsCmd {\n       fn execute(&self, project_root: &Path) -> Result<ExitCode> {\n           match &self.command {\n               TsCommands::List { package, all } => {\n                   ts_cmd::list_tspecs(package.as_deref(), *all)?;\n               }\n               // ... other variants\n           }\n           Ok(ExitCode::SUCCESS)\n       }\n   }\n   ```\n\n2. **Move `TsCommands` enum** from `cli.rs` to `src/cmd/ts.rs` (or keep in cli.rs and import — either works, but co-locating with the Execute impl is cleaner).\n\n3. **Update `cli.rs`** to use `Ts(TsCmd)` tuple variant instead of `Ts { command: TsCommands }` struct variant:\n   ```rust\n   // Before\n   Ts {\n       #[command(subcommand)]\n       command: TsCommands,\n   },\n   // After\n   Ts(TsCmd),\n   ```\n\n4. **Update `src/cmd/mod.rs`** to add `mod ts;` and `pub use ts::TsCmd;`.\n\n5. **Update main.rs** to replace the 30-line `Ts` match arm with the one-liner.\n\n6. **Consider whether `ts_cmd/` functions need `project_root`** — currently they call `find_project_root()` internally or use `current_dir()`. The Execute trait passes `project_root`, so the ts_cmd functions could be updated to accept it instead of finding it themselves. This is optional but would make them consistent.\n\n**Files affected:**\n- `src/cmd/ts.rs` (new)\n- `src/cmd/mod.rs` (add module + re-export)\n- `src/cli.rs` (change `Ts` variant, possibly move `TsCommands`)\n- `src/main.rs` (simplify match arm)\n- `src/ts_cmd/*.rs` (optional: accept `project_root` parameter)\n\n**Status:** Done\n\n## 20260206 - Add `cargo.target_dir` spec field\n\n### The Problem\n\nWhen two specs share the same target triple, builds overwrite each other in `target/{triple}/{profile}/`. This makes `tspec compare` unreliable and prevents side-by-side builds.\n\n### The Design\n\nAdd a `target_dir` field to the `[cargo]` spec section with template placeholder support:\n\n```toml\n[cargo]\ntarget_dir = \"<name>\"           # spec filename sans .ts.toml\ntarget_dir = \"<hash>\"           # 8-char content hash\ntarget_dir = \"<name>-<hash>\"    # combined\ntarget_dir = \"\"                 # empty = no subdir (backward compat)\n```\n\nPath structure uses cargo's native `--target-dir`: `target/{target_dir}/{triple}/{profile}/{binary}`\n\nDefault when field absent: empty (backward compatible, no subdirectory).\n\n### The Plan\n\nThe `target_dir` field threads through the build pipeline: types → spec loading → path resolution → cargo command → binary scanning. The double `load_spec` call in `build_crate` gets consolidated along the way.\n\n1. **Add `target_dir` field to `CargoConfig`** (`src/types.rs`)\n   - Add `pub target_dir: Option<String>` to `CargoConfig`\n\n2. **Add helpers in `src/tspec.rs`**\n   - `spec_name_from_path(path: &Path) -> String` — strips `.ts.toml` suffix from filename\n   - `expand_target_dir(spec: &Spec, spec_name: &str) -> Result<Option<String>>` — expands `<name>` and `<hash>` placeholders; returns `None` if field is absent or empty\n\n3. **Update `get_binary_path`** (`src/find_paths.rs`)\n   - Add `expanded_target_dir: Option<&str>` parameter\n   - When `Some(td)`, base path becomes `workspace.join(\"target\").join(td)` instead of `workspace.join(\"target\")`\n   - Update existing test call sites to pass `None`\n\n4. **Update `apply_spec_to_command`** (`src/cargo_build.rs`)\n   - Add `expanded_target_dir: Option<&str>` parameter\n   - When `Some(td)`, insert `--target-dir target/{td}` into cargo command\n   - Fix version script path to use expanded target dir\n\n5. **Refactor `build_crate`** (`src/cargo_build.rs`)\n   - Consolidate the double `load_spec` call into one\n   - Compute `spec_name` and `expanded_td` after loading\n   - Pass `expanded_td` to both `get_binary_path` and `apply_spec_to_command`\n   - Add `target_base: PathBuf` to `BuildResult`\n\n6. **Update `test_crate`** (`src/testing.rs`)\n   - Compute `expanded_td` from loaded spec and pass to `apply_spec_to_command`\n\n7. **Fix test binary scanning** (`src/all.rs`)\n   - Capture `BuildResult` from `build_crate` (currently only error case captured)\n   - Use `build_result.target_base.join(profile)` instead of hardcoded `workspace.root.join(\"target\").join(profile)`\n\n8. **Add `cargo.target_dir` to `tspec ts set`** (`src/ts_cmd/set.rs`)\n   - Add match arm for `\"cargo.target_dir\"` in `apply_value`\n\n9. **Tests**\n   - Unit tests for `expand_target_dir` (None, empty, literal, `<name>`, `<hash>`, combined)\n   - Unit tests for `spec_name_from_path`\n   - Unit test for `get_binary_path` with target_dir\n   - Unit test for `apply_value` with `cargo.target_dir`\n   - Existing tests: append `None` to `get_binary_path` calls (mechanical)\n\n**Status:** Done\n\n## 20260207 - In-place `set`, add `backup` and `restore` subcommands\n\n### The Problem\n\n`tspec ts set` creates a new snapshot file (`name-NNN-hash.ts.toml`) on every edit.\nChaining edits compounds the names: `t1-001-xxx-001-yyy.ts.toml`. The file you work\nwith should keep its name; backup/restore should be explicit user actions.\n\n### The Design\n\n1. **`tspec ts set`** modifies the file in place (no snapshot creation)\n2. **`tspec ts backup -t t1.ts.toml`** creates `t1-001-<hash>.ts.toml`\n3. **`tspec ts restore -t t1-001-<hash>.ts.toml`** copies it back to `t1.ts.toml`\n4. Backups are valid specs — `tspec build -t t1-001-<hash>.ts.toml` works directly\n\n### The Plan\n\n#### 1. Modify `tspec ts set` to save in place\n\n**File:** `src/ts_cmd/set.rs`\n\n- Change `set_value()` to save back to the original file path instead of calling `save_spec_snapshot()`\n- If the file existed (found via `find_tspec()`), save to that path\n- If no file existed, construct path from `-t` arg (or default `tspec`) + `TSPEC_SUFFIX` in package dir\n- Use existing `save_spec()` instead of `save_spec_snapshot()`\n- Remove `save_spec_snapshot` import\n\n**File:** `src/cmd/ts.rs`\n- Update `Set` variant doc comment from \"creates versioned copy\" to \"modifies in place\"\n\n#### 2. Add `tspec ts backup` subcommand\n\n**New file:** `src/ts_cmd/backup.rs`\n\n```rust\npub fn backup_tspec(project_root, package, tspec) -> Result<()>\n```\n\n- Locate the spec via `find_tspec()`; error if not found\n- Extract base name via `spec_name_from_path()`\n- Load the spec, call existing `save_spec_snapshot()` to create `{name}-NNN-{hash}.ts.toml`\n- Print the backup filename\n\n**File:** `src/cmd/ts.rs` — add `Backup` variant with `-p` and `-t` args, dispatch\n**File:** `src/ts_cmd/mod.rs` — add `mod backup;` and `pub use backup::backup_tspec;`\n\n#### 3. Add `tspec ts restore` subcommand\n\n**New file:** `src/ts_cmd/restore.rs`\n\n```rust\npub fn restore_tspec(project_root, package, tspec) -> Result<()>\n```\n\n- Locate the backup file via `find_tspec()` (`-t` required)\n- Parse the filename to extract the base name by stripping trailing `-NNN-HHHHHHHH`\n  (3-digit seq + 8-char hex hash) from the stem before `.ts.toml`\n- Construct target path: `{base_name}.ts.toml` in the same directory\n- Copy content to the base file using `load_spec()` + `save_spec()`\n- Print what was restored\n\n**File:** `src/cmd/ts.rs` — add `Restore` variant with `-p` and `-t` (required) args, dispatch\n**File:** `src/ts_cmd/mod.rs` — add `mod restore;` and `pub use restore::restore_tspec;`\n\n### Files modified\n- `src/ts_cmd/set.rs` — save in place instead of snapshot\n- `src/cmd/ts.rs` — add Backup/Restore variants, update Set doc\n- `src/ts_cmd/mod.rs` — register new modules\n\n### Files created\n- `src/ts_cmd/backup.rs` — backup logic\n- `src/ts_cmd/restore.rs` — restore logic (with name-suffix parsing)\n\n### Verification\n```bash\ntspec test -p tspec\ntspec clippy\ntspec fmt --check\n\n# Manual smoke test:\ntspec ts new t2\ntspec ts set strip=symbols -t t2.ts.toml      # modifies t2.ts.toml in place\ntspec ts show -t t2.ts.toml                    # shows strip = \"symbols\"\ntspec ts backup -t t2.ts.toml                  # creates t2-001-<hash>.ts.toml\ntspec ts set panic=abort -t t2.ts.toml         # modifies t2.ts.toml again\ntspec ts show -t t2.ts.toml                    # shows panic + strip\ntspec ts restore -t t2-001-<hash>.ts.toml      # restores t2.ts.toml to pre-panic state\ntspec build -t t2-001-<hash>.ts.toml           # backup usable directly\n```\n\n**Status:** Todo\n","structuredPatch":[{"oldStart":246,"oldLines":4,"newStart":246,"newLines":4,"lines":[" tspec build -t t2-001-<hash>.ts.toml           # backup usable directly"," ```"," ","-**Status:** Todo","+**Status:** Done"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"ce6f901d-6123-4a0a-a9cb-aa7afb1d65dc"}
+{"type":"file-history-snapshot","messageId":"20654583-5bf8-4142-ae9d-e0836f247fc4","snapshot":{"messageId":"ec052246-8a0b-41e6-bb57-64dcbb95f962","trackedFileBackups":{"src/ts_cmd/set.rs":{"backupFileName":"a2565033032b5dbe@v2","version":2,"backupTime":"2026-02-08T00:14:14.088Z"},"src/cmd/ts.rs":{"backupFileName":"e2251d2c5ab28f04@v2","version":2,"backupTime":"2026-02-08T00:14:14.090Z"},"src/ts_cmd/backup.rs":{"backupFileName":"8e726b68ba4786f1@v2","version":2,"backupTime":"2026-02-08T00:14:14.091Z"},"src/ts_cmd/restore.rs":{"backupFileName":"7c09d9c89b5f6a5d@v2","version":2,"backupTime":"2026-02-08T00:14:14.093Z"},"src/ts_cmd/mod.rs":{"backupFileName":"64a023b44b4e6d0c@v2","version":2,"backupTime":"2026-02-08T00:14:14.094Z"},"notes/chores-2.md":{"backupFileName":"86cffcb836353b51@v1","version":1,"backupTime":"2026-02-08T00:26:48.231Z"},"notes/todo.md":{"backupFileName":"fc3a27d7d59118b5@v1","version":1,"backupTime":"2026-02-08T00:26:49.981Z"}},"timestamp":"2026-02-08T00:26:40.025Z"},"isSnapshotUpdate":true}
+{"parentUuid":"e1e60c54-d1fd-4a3e-9dbf-dbc6916e94f8","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_0112jnBXakKB1ChstaXEMD8j","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Jcf3FRqH6PNzoxNWHtUHdx","name":"Edit","input":{"replace_all":false,"file_path":"/home/wink/data/prgs/rust/tspec/notes/todo.md","old_string":"- In-place `set`, add `backup` and `restore` subcommands [15]\n- Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]","new_string":"- Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2554,"cache_read_input_tokens":61082,"output_tokens":336,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2554,"ephemeral_5m_input_tokens":0}}},"requestId":"req_011CXueqFBje8aBFZrNZDXho","type":"assistant","uuid":"20654583-5bf8-4142-ae9d-e0836f247fc4","timestamp":"2026-02-08T00:26:49.968Z"}
+{"parentUuid":"20654583-5bf8-4142-ae9d-e0836f247fc4","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01Jcf3FRqH6PNzoxNWHtUHdx","toolUseID":"toolu_01Jcf3FRqH6PNzoxNWHtUHdx","timestamp":"2026-02-08T00:26:49.997Z","uuid":"057f86fe-eeaf-4248-8310-961bc40e702b"}
+{"parentUuid":"20654583-5bf8-4142-ae9d-e0836f247fc4","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Jcf3FRqH6PNzoxNWHtUHdx","type":"tool_result","content":"The file /home/wink/data/prgs/rust/tspec/notes/todo.md has been updated successfully."}]},"uuid":"9124801f-b9be-449e-9038-0a63198d3f12","timestamp":"2026-02-08T00:26:49.997Z","toolUseResult":{"filePath":"/home/wink/data/prgs/rust/tspec/notes/todo.md","oldString":"- In-place `set`, add `backup` and `restore` subcommands [15]\n- Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]","newString":"- Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]","originalFile":"# Todo\n\n## In Progress\n\n## Todo\n\n- In-place `set`, add `backup` and `restore` subcommands [15]\n- Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]\n- Improve `classify_crate` - using name alone is brittle [4]\n\n## Done\n\nSee older [done.md](done.md)\n\n- Add `cargo.target_dir` spec field for per-spec target directories [12],[14]\n\n[4]: chores-1.md#improve-classify_crate\n[11]: chores-1.md#investigate--static-vs-dynamic-linkingfalse-size-difference\n[12]: chores-1.md#per-spec-target-directories\n[14]: chores-2.md#20260206---add-cargotarget_dir-spec-field\n[15]: chores-2.md#20260207---in-place-set-add-backup-and-restore-subcommands\n","structuredPatch":[{"oldStart":4,"oldLines":7,"newStart":4,"newLines":6,"lines":[" "," ## Todo"," ","-- In-place `set`, add `backup` and `restore` subcommands [15]"," - Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]"," - Improve `classify_crate` - using name alone is brittle [4]"," "]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"20654583-5bf8-4142-ae9d-e0836f247fc4"}
+{"parentUuid":"9124801f-b9be-449e-9038-0a63198d3f12","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_013i951M9B1w2R1jzQyFxXMZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KhTUF35mGECAvnN2ttDVV8","name":"Edit","input":{"replace_all":false,"file_path":"/home/wink/data/prgs/rust/tspec/notes/todo.md","old_string":"- Add `cargo.target_dir` spec field for per-spec target directories [12],[14]","new_string":"- In-place `set`, add `backup` and `restore` subcommands [15]\n- Add `cargo.target_dir` spec field for per-spec target directories [12],[14]"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":490,"cache_read_input_tokens":63636,"output_tokens":194,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":490,"ephemeral_5m_input_tokens":0}}},"requestId":"req_011CXueqdTgqSy3AMKhifmwB","type":"assistant","uuid":"27818279-390b-4177-b523-1b20199a019c","timestamp":"2026-02-08T00:26:53.883Z"}
+{"parentUuid":"27818279-390b-4177-b523-1b20199a019c","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Edit","command":"callback"},"parentToolUseID":"toolu_01KhTUF35mGECAvnN2ttDVV8","toolUseID":"toolu_01KhTUF35mGECAvnN2ttDVV8","timestamp":"2026-02-08T00:26:53.901Z","uuid":"2fb06d92-35c9-45fe-8cd6-6166b09e9383"}
+{"parentUuid":"27818279-390b-4177-b523-1b20199a019c","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KhTUF35mGECAvnN2ttDVV8","type":"tool_result","content":"The file /home/wink/data/prgs/rust/tspec/notes/todo.md has been updated successfully."}]},"uuid":"0410a26e-1f31-43d0-b9bc-ac108220c81f","timestamp":"2026-02-08T00:26:53.901Z","toolUseResult":{"filePath":"/home/wink/data/prgs/rust/tspec/notes/todo.md","oldString":"- Add `cargo.target_dir` spec field for per-spec target directories [12],[14]","newString":"- In-place `set`, add `backup` and `restore` subcommands [15]\n- Add `cargo.target_dir` spec field for per-spec target directories [12],[14]","originalFile":"# Todo\n\n## In Progress\n\n## Todo\n\n- Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]\n- Improve `classify_crate` - using name alone is brittle [4]\n\n## Done\n\nSee older [done.md](done.md)\n\n- Add `cargo.target_dir` spec field for per-spec target directories [12],[14]\n\n[4]: chores-1.md#improve-classify_crate\n[11]: chores-1.md#investigate--static-vs-dynamic-linkingfalse-size-difference\n[12]: chores-1.md#per-spec-target-directories\n[14]: chores-2.md#20260206---add-cargotarget_dir-spec-field\n[15]: chores-2.md#20260207---in-place-set-add-backup-and-restore-subcommands\n","structuredPatch":[{"oldStart":11,"oldLines":6,"newStart":11,"newLines":7,"lines":[" "," See older [done.md](done.md)"," ","+- In-place `set`, add `backup` and `restore` subcommands [15]"," - Add `cargo.target_dir` spec field for per-spec target directories [12],[14]"," "," [4]: chores-1.md#improve-classify_crate"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"27818279-390b-4177-b523-1b20199a019c"}
+{"parentUuid":"0410a26e-1f31-43d0-b9bc-ac108220c81f","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01AA4NE3cDbkFRd9cdLzwb12","type":"message","role":"assistant","content":[{"type":"text","text":"Done. Updated chores-2.md status to \"Done\" and moved the item from Todo to Done in todo.md. Ready for experiments."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":233,"cache_read_input_tokens":64126,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":233},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXueqv35dykQ2Ss1uC9dS","type":"assistant","uuid":"0ef00f52-8fe2-46b7-a348-c3b7b649ca01","timestamp":"2026-02-08T00:26:56.507Z"}
+{"type":"file-history-snapshot","messageId":"42f68398-4c29-415b-a15e-3498ac4a8d22","snapshot":{"messageId":"42f68398-4c29-415b-a15e-3498ac4a8d22","trackedFileBackups":{"src/ts_cmd/set.rs":{"backupFileName":"a2565033032b5dbe@v2","version":2,"backupTime":"2026-02-08T00:14:14.088Z"},"src/cmd/ts.rs":{"backupFileName":"e2251d2c5ab28f04@v2","version":2,"backupTime":"2026-02-08T00:14:14.090Z"},"src/ts_cmd/backup.rs":{"backupFileName":"8e726b68ba4786f1@v2","version":2,"backupTime":"2026-02-08T00:14:14.091Z"},"src/ts_cmd/restore.rs":{"backupFileName":"7c09d9c89b5f6a5d@v2","version":2,"backupTime":"2026-02-08T00:14:14.093Z"},"src/ts_cmd/mod.rs":{"backupFileName":"64a023b44b4e6d0c@v2","version":2,"backupTime":"2026-02-08T00:14:14.094Z"},"notes/chores-2.md":{"backupFileName":"86cffcb836353b51@v2","version":2,"backupTime":"2026-02-08T00:27:34.461Z"},"notes/todo.md":{"backupFileName":"fc3a27d7d59118b5@v2","version":2,"backupTime":"2026-02-08T00:27:34.463Z"}},"timestamp":"2026-02-08T00:27:34.449Z"},"isSnapshotUpdate":false}
+{"parentUuid":"0ef00f52-8fe2-46b7-a348-c3b7b649ca01","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":"commit this"},"uuid":"42f68398-4c29-415b-a15e-3498ac4a8d22","timestamp":"2026-02-08T00:27:34.448Z","thinkingMetadata":{"maxThinkingTokens":31999},"permissionMode":"acceptEdits"}
+{"parentUuid":"42f68398-4c29-415b-a15e-3498ac4a8d22","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01FEui3VrdhYejZtaoXg84F9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BMWo9of5zBW7S5ur32tjWn","name":"Bash","input":{"command":"git -C /home/wink/data/prgs/rust/tspec status","description":"Show working tree status"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":5,"cache_read_input_tokens":64391,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5},"output_tokens":20,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXuetufLqTTBqcwMJYrmh","type":"assistant","uuid":"383a5723-70aa-4531-981c-1b35fda9ebda","timestamp":"2026-02-08T00:27:37.367Z"}
+{"parentUuid":"383a5723-70aa-4531-981c-1b35fda9ebda","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01FEui3VrdhYejZtaoXg84F9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HmT3j4xGmc7qHFCqceDP2m","name":"Bash","input":{"command":"git -C /home/wink/data/prgs/rust/tspec diff","description":"Show unstaged changes"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":5,"cache_read_input_tokens":64391,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5},"output_tokens":20,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXuetufLqTTBqcwMJYrmh","type":"assistant","uuid":"9cc17fda-7c11-45dc-ac0b-4cac2609cc3d","timestamp":"2026-02-08T00:27:37.946Z"}
+{"parentUuid":"9cc17fda-7c11-45dc-ac0b-4cac2609cc3d","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","message":{"model":"claude-opus-4-6","id":"msg_01FEui3VrdhYejZtaoXg84F9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01G2YarT2yw3gXjwa1ZRxWGw","name":"Bash","input":{"command":"git -C /home/wink/data/prgs/rust/tspec log --oneline -3","description":"Show recent commits"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":5,"cache_read_input_tokens":64391,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5},"output_tokens":20,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CXuetufLqTTBqcwMJYrmh","type":"assistant","uuid":"fb2e8c35-bd6e-49bc-b66f-2ef6cf6a6c6c","timestamp":"2026-02-08T00:27:38.501Z"}
+{"parentUuid":"383a5723-70aa-4531-981c-1b35fda9ebda","isSidechain":false,"userType":"external","cwd":"/home/wink/data/prgs/rust/tspec","sessionId":"a61b758b-0ffc-474b-950f-45c9c8ba5a1c","version":"2.1.34","gitBranch":"main","slug":"vectorized-gathering-rose","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BMWo9of5zBW7S5ur32tjWn","type":"tool_result","content":"On branch main\nYour branch is up to date with 'origin/main'.\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   .claude/a61b758b-0ffc-474b-950f-45c9c8ba5a1c.jsonl\n\tmodified:   notes/chores-2.md\n\tmodified:   notes/todo.md\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\tt1-001-335c8729.ts.toml\n\tt1-002-3ed03c19.ts.toml\n\tt1.ts.toml\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")","is_error":false}]},"uuid":"85476528-56eb-4dc9-b908-8780cf263d1b","timestamp":"2026-02-08T00:27:39.674Z","toolUseResult":{"stdout":"On branch main\nYour branch is up to date with 'origin/main'.\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   .claude/a61b758b-0ffc-474b-950f-45c9c8ba5a1c.jsonl\n\tmodified:   notes/chores-2.md\n\tmodified:   notes/todo.md\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\tt1-001-335c8729.ts.toml\n\tt1-002-3ed03c19.ts.toml\n\tt1.ts.toml\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")","stderr":"","interrupted":false,"isImage":false},"sourceToolAssistantUUID":"383a5723-70aa-4531-981c-1b35fda9ebda"}
diff --git a/.claude/settings.local.json b/.claude/settings.local.json
index 9d5a2b3..1f2afbb 100644
--- a/.claude/settings.local.json
+++ b/.claude/settings.local.json
@@ -12,7 +12,8 @@
       "Bash(tspec ts show:*)",
       "Bash(tspec ts hash:*)",
       "Bash(tspec test:*)",
-      "Bash(tspec clippy:*)"
+      "Bash(tspec clippy:*)",
+      "Bash(git -C /home/wink/data/prgs/rust/tspec diff)"
     ]
   }
 }
diff --git a/notes/chores-2.md b/notes/chores-2.md
index df5310d..bb4fdec 100644
--- a/notes/chores-2.md
+++ b/notes/chores-2.md
@@ -246,4 +246,4 @@ tspec ts restore -t t2-001-<hash>.ts.toml      # restores t2.ts.toml to pre-pani
 tspec build -t t2-001-<hash>.ts.toml           # backup usable directly
 ```
 
-**Status:** Todo
+**Status:** Done
diff --git a/notes/todo.md b/notes/todo.md
index 1d878c1..d4f0a21 100644
--- a/notes/todo.md
+++ b/notes/todo.md
@@ -4,7 +4,6 @@
 
 ## Todo
 
-- In-place `set`, add `backup` and `restore` subcommands [15]
 - Investigate `-static` vs `dynamic-linking=false` size difference (partially explained); note: glibc + `-static` segfaults (glibc not designed for static linking), consider musl for static builds [11]
 - Improve `classify_crate` - using name alone is brittle [4]
 
@@ -12,6 +11,7 @@
 
 See older [done.md](done.md)
 
+- In-place `set`, add `backup` and `restore` subcommands [15]
 - Add `cargo.target_dir` spec field for per-spec target directories [12],[14]
 
 [4]: chores-1.md#improve-classify_crate